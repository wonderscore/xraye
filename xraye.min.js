/* ==========================================================
 * x r a y e
 * Annotate sizing and spacing of HTML elements
 * v0.8.0
 * 
 * https://github.com/wonderscore/xraye
 *
 * Author: Danny Allen (me@dannya.com)
 * Author: Wonderscore Ltd (wonderscore.co.uk)
 *
 * Copyright 2017 Danny Allen & Wonderscore Ltd
 * Licensed under MIT
 ========================================================== */
!function(t,a,n,o){var e={active:!0,pointerTransparency:!1,showSizing:!0,showSpacing:!0,showPropertyNames:!0,displayUnitsPixels:!0,displayUnitsPercent:!0,exclude:"",excludeChildrenOf:"",valueAnnotationThreshold:10,controlIcon:{position:"left",offset:"-48px"},annotationColors:{sizing:{line:"black",box:"black",arrow:"red",text:"white","line:hover":"red","box:hover":"red","arrow:hover":"red","text:hover":"white"},spacing:{line:"orange",box:"orange",arrow:"green",text:"black","line:hover":"green","box:hover":"green","arrow:hover":"green","text:hover":"white"}},levelColors:{1:"blue",2:"red",3:"yellow",4:"orange",5:"green",6:"purple",7:"pink",8:"brown",9:"beige"}},i=function(n,o){if(this.element=n,this.options=t.extend({},e,o),this._defaults=e,this._name="xraye",this.id=this.getRandomId(),this.annotationPropertyMapping={sizing:["width","height"],spacing:["paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","marginLeft","marginRight"]},this.elementData={},this.styles={},this.canvasStyles={},this.levelColors=this.options.levelColors||{},this.initialStyles="@keyframes xraye-attention { 50% { padding: 3px 5px 5px 5px; } }",this.$element=t(this.element),this.$insertionElement=t("body"),this.$container=t('<div data-xraye="'+this.id+'" data-xraye-container />'),this.$styles=t("<style data-xraye-styles />"),this.$canvasStyles=t('<style data-xraye-styles="canvas" />'),this.$canvas=t('<div data-xraye="'+this.id+'" data-xraye-canvas />'),this.$controlPanel=t("<div data-xraye-controlpanel />"),this.$icon=t('<svg data-xraye-controlicon xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 24 24" width="48" height="48" viewBox="0 0 12.7 12.7"><path d="M 2.1895215,-1.1e-4 6.78774e-7,2.18941 0.74872076,2.93813 2.9382416,0.74861 Z m 1.1228974,1.1229 -2.1895208,2.18952 9.0135079,9.01351 2.189521,-2.18952 z M 12.700104,10.51048 10.511309,12.7 h 2.188792 z"/><path d="M 6.7245952,3.78588 8.9141171,5.9754 12.700104,2.18941 10.510582,-1.1e-4 9.7622282,0.74824 10.856623,1.84264 10.482446,2.21682 9.3880509,1.12242 8.6396962,1.87077 9.7340917,2.96517 9.3599144,3.33935 8.2655189,2.24495 7.5171642,2.99331 8.6115597,4.0877 8.2373824,4.46188 7.1429869,3.36748 Z"/><path d="M 1.1225318,9.38721 2.2172929,10.48197 1.8431156,10.85615 0.74872008,9.76175 0,10.51047 2.1895218,12.69999 5.975875,8.91437 3.785622,6.72412 3.3675957,7.14214 4.4623569,8.2369 4.0881795,8.61108 2.9934184,7.51632 2.2450638,8.26468 3.3398249,9.35944 2.9656476,9.73361 1.8708865,8.63885 Z"/></svg>'),"function"==typeof this.options.canInit)var i=this,r=a.setInterval(function(){i.options.canInit()&&(a.clearInterval(r),i.init())},this.options.canInitInterval?this.options.canInitInterval:500);else this.init()};i.prototype={init:function(){this.elementData=this.getElementData(this.$element),this.styles["&"]={position:"absolute",left:this.elementData.left+"px",top:this.elementData.top+"px",width:this.elementData.width+"px",height:this.elementData.height+"px"},this.$insertionElement.css("overflow","hidden"),this.renderElement([this.$styles,this.$canvasStyles],this.$container),this.renderElement([this.$container,this.$canvas],this.$insertionElement),this.drawControlPanel(),this.updateStyles(this.initialStyles+this.stringifyStyles(this.styles)),this.clearCanvas(),this.options.active&&this.drawAnnotations(),this.updateCanvasStyles(this.stringifyStyles(this.canvasStyles))},clearCanvas:function(){this.canvasStyles={},this.setSharedCanvasStyles(),this.$canvas.html("")},drawAnnotations:function(){if(!this.isExcluded(this.$element)&&!this.isExcludedChildren(this.$element)){var t=this.$element.children();t.length>0&&this.processElements(t,1)}},isExcluded:function(t){var a=!1;return"function"==typeof this.options.exclude?a=this.options.exclude(t):"string"==typeof this.options.exclude&&this.options.exclude.length>0&&(a=!t.is(this.options.exclude)),a},isExcludedChildren:function(t){var a=!1;return"function"==typeof this.options.excludeChildrenOf?a=this.options.excludeChildrenOf(t):"string"==typeof this.options.excludeChildrenOf&&this.options.excludeChildrenOf.length>0&&(a=!t.is(this.options.excludeChildrenOf)),a},setSharedCanvasStyles:function(){this.options.active&&!this.options.pointerTransparency||(this.canvasStyles["&[data-xraye-canvas]"]={"pointer-events":"none"}),this.canvasStyles["[data-xraye-arrow]"]={position:"absolute",opacity:this.options.pointerTransparency?"1":"0.3","pointer-events":"none"},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"]']={"text-align":"center","border-top":"2px solid"},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="sizing"]']={"border-top-color":this.options.annotationColors.sizing.line},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="spacing"]']={"border-top-color":this.options.annotationColors.spacing.line},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"] span']={display:"inline-block","white-space":"nowrap",padding:"1px 3px 3px 3px","z-index":"10001",transform:"translate(-100%, -50%)"},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="sizing"] span']={color:this.options.annotationColors.sizing.text,background:this.options.annotationColors.sizing.box},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="spacing"] span']={color:this.options.annotationColors.spacing.text,background:this.options.annotationColors.spacing.box},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"]:before']={content:'"\\25C0"',display:"inline-block",position:"absolute",left:"-2px",top:"-11px","font-size":"14px"},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="sizing"]:before']={color:this.options.annotationColors.sizing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="spacing"]:before']={color:this.options.annotationColors.spacing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"]:after']={content:'"\\25B6"',display:"inline-block",position:"absolute",right:"-1px",top:"-11px","font-size":"14px"},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="sizing"]:after']={color:this.options.annotationColors.sizing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="spacing"]:after']={color:this.options.annotationColors.spacing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="vertical"]']={display:"flex","flex-direction":"column","justify-content":"center","border-left":"2px solid"},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="sizing"]']={"border-left-color":this.options.annotationColors.sizing.line},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="spacing"]']={"border-left-color":this.options.annotationColors.spacing.line},this.canvasStyles['[data-xraye-arrow-orientation="vertical"] span']={display:"inline-block","white-space":"nowrap",padding:"1px 3px 3px 3px","z-index":"10001",transform:"translate(-50%, 0)"},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="sizing"] span']={color:this.options.annotationColors.sizing.text,background:this.options.annotationColors.sizing.box},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="spacing"] span']={color:this.options.annotationColors.spacing.text,background:this.options.annotationColors.spacing.box},this.canvasStyles['[data-xraye-arrow-orientation="vertical"]:before']={content:'"\\25B2"',display:"inline-block",position:"absolute",left:"-8px",top:"-7px","font-size":"14px"},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="sizing"]:before']={color:this.options.annotationColors.sizing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="spacing"]:before']={color:this.options.annotationColors.spacing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="vertical"]:after']={content:'"\\25BC"',display:"inline-block",position:"absolute",left:"-8px",bottom:"-7px","font-size":"14px"},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="sizing"]:after']={color:this.options.annotationColors.sizing.arrow},this.canvasStyles['[data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="spacing"]:after']={color:this.options.annotationColors.spacing.arrow}},drawControlPanel:function(){var a=this;this.renderElement([this.$icon,this.$controlPanel],this.$container),this.$controlPanel.append(t("<div />").append(t("<h1 />").append(this.drawCheckbox("active","xray elements")),t("<fieldset />").append(t("<legend />").text("Show"),this.drawCheckbox("showPropertyNames","Property names"),this.drawCheckbox("showSizing","Sizing"),this.drawCheckbox("showSpacing","Spacing")),t("<fieldset />").append(t("<legend />").text("Display units"),this.drawCheckbox("displayUnitsPixels","Pixels (px)"),this.drawCheckbox("displayUnitsPercent","Percent (%)")),t("<fieldset />").append(t("<legend />").text("Other"),this.drawCheckbox("pointerTransparency","Mouse pointer transparency")))),this.styles["[data-xraye-controlicon]"]={position:"absolute",top:"0",cursor:"pointer","z-index":"12000",transition:"transform 0.3s ease-in-out"},this.styles["[data-xraye-controlicon]"][this.options.controlIcon.position]=this.options.controlIcon.offset,this.styles["[data-xraye-controlicon]:hover path"]={fill:"red"},this.styles["&[data-xraye-container]"]={width:"0",transition:"width 0.5s ease-in-out"},this.styles["[data-xraye-controlpanel]"]={position:"absolute","min-height":"200px",left:"-10px",top:"-10px",bottom:"-10px",width:"0",padding:"18px 0",background:"rgba(0, 0, 0, 0.8)",color:"white","font-size":"16px","z-index":"11000","overflow-y":"auto",transition:"width 0.5s ease-in-out, padding 0.5s ease-in-out"},this.styles["[data-xraye-controlpanel] > div"]={opacity:"0",transition:"opacity 0.25s ease-in-out"},this.styles["[data-xraye-controlpanel] label"]={display:"block",cursor:"pointer"},this.styles["[data-xraye-controlpanel] label input"]={float:"left",margin:"7px 10px 0 4px"},this.styles["[data-xraye-controlpanel] h1"]={"font-family":"monospace","font-size":"20px"},this.styles["[data-xraye-controlpanel] h1 label input"]={"margin-top":"9px"},this.styles["[data-xraye-controlpanel] fieldset"]={"margin-top":"20px"},this.styles["[data-xraye-controlpanel] fieldset legend"]={padding:"0 10px 2px 10px",margin:"0 0 0 -20px"},this.styles["&[data-xraye-container].xraye-controlpanel-visible [data-xraye-controlicon]"]={transform:"rotate(-45deg)"},this.styles["&[data-xraye-container].xraye-controlpanel-visible"]={width:this.$element.outerWidth()+20+"px"},this.styles["&[data-xraye-container].xraye-controlpanel-visible [data-xraye-controlpanel]"]={padding:"18px",width:this.$element.outerWidth()+20+"px"},this.styles["&[data-xraye-container].xraye-controlpanel-visible [data-xraye-controlpanel] > div"]={opacity:"1"},this.$icon.off("click.xraye-controlpanel").on("click.xraye-controlpanel",function(t){return t.preventDefault(),a.$container.toggleClass("xraye-controlpanel-visible"),!1})},drawCheckbox:function(a,n){var o=this;return t("<label />").append(t('<input type="checkbox" id="'+a+'"'+(this.options[a]?' checked="checked"':"")+" />").on("change",function(t){o.changeOption(this.id,this.checked)}),"<span>"+n+"</span>")},changeOption:function(t,a,n){this.options[t]=a,!1!==n&&(this.clearCanvas(),this.options.active&&(this.drawAnnotations(),this.updateCanvasStyles(this.stringifyStyles(this.canvasStyles))))},stringifyStyles:function(t){var a="";for(var n in t){a+='[data-xraye="'+this.id+'"]',"&"===n[0]?a+=n.substr(1)+" {":a+=" "+n+" {";for(var o in t[n])a+=o+": "+t[n][o]+";";a+="}\n"}return a},drawArrow:function(a,n,o,e,i,r){var s;-1!==this.annotationPropertyMapping.sizing.indexOf(n)?s="sizing":-1!==this.annotationPropertyMapping.spacing.indexOf(n)&&(s="spacing");var l,h='data-xraye-element="'+a+'"',p='data-xraye-arrow="'+a+"_"+n+'"',d='data-xraye-arrow-annotation="'+s+'"',c="["+p+"]";!1===o?(l='data-xraye-arrow-orientation="vertical"',this.canvasStyles[c]={left:e-1+"px",top:i+"px",height:r+"px"}):(l='data-xraye-arrow-orientation="horizontal"',this.canvasStyles[c]={left:e+"px",top:i-2+"px",width:r+"px"});var y=[];this.options.displayUnitsPixels&&y.push(r+"px"),this.options.displayUnitsPercent&&(o?this.elementData.width>0&&y.push(Math.round(r/this.elementData.width*100)+"%"):this.elementData.height>0&&y.push(Math.round(r/this.elementData.height*100)+"%")),this.renderElement(t("<div "+h+" "+p+" "+l+" "+d+" />").append(t("<span />").text((this.options.showPropertyNames?n+" ":"")+y.join(" / "))))},drawElementMask:function(a,n,o,e,i,r){var s='data-xraye-element="'+a+'"',l='data-xraye-mask="'+a+'"',h='data-xraye-level="'+n+'"',p="["+l+"]";this.canvasStyles[p]={position:"absolute",left:o+"px",top:e+"px",width:i+"px",height:r+"px",outline:"1px dashed "+this.levelColors[n]},this.canvasStyles[p+":hover"]={"outline-style":"solid","background-color":"rgba(0, 0, 0, 0.2)","background-image":"repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 255, 255, 0.2) 35px, rgba(255, 255, 255, 0.2) 70px)"},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow]']={opacity:"1","z-index":"10011"},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="sizing"]']={"border-top-color":this.options.annotationColors.sizing["line:hover"]},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow-orientation="horizontal"][data-xraye-arrow-annotation="spacing"]']={"border-top-color":this.options.annotationColors.spacing["line:hover"]},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="sizing"]']={"border-left-color":this.options.annotationColors.sizing["line:hover"]},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow-orientation="vertical"][data-xraye-arrow-annotation="spacing"]']={"border-left-color":this.options.annotationColors.spacing["line:hover"]},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow] span']={animation:"xraye-attention 0.3s linear 1"},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow][data-xraye-arrow-annotation="sizing"] span']={color:this.options.annotationColors.sizing["text:hover"],background:this.options.annotationColors.sizing["box:hover"]},this.canvasStyles[p+':hover ~ [data-xraye-element="'+a+'"][data-xraye-arrow][data-xraye-arrow-annotation="spacing"] span']={color:this.options.annotationColors.spacing["text:hover"],background:this.options.annotationColors.spacing["box:hover"]},this.renderElement(t("<div "+s+" "+h+" "+l+" />"))},renderElement:function(t,a){if(a||(a=this.$canvas),t instanceof Array)for(var n in t)a.append(t[n]);else a.append(t)},updateStyles:function(t){this.$styles.html(t)},updateCanvasStyles:function(t){this.$canvasStyles.html(t)},getRandomColor:function(){return"#"+(~~(Math.random()*(1<<24))).toString(16)},getRandomId:function(t,a){return t||(t=""),a||(a=""),t+Math.floor(1e5*Math.random())+a},processElements:function(n,o){var e=this;void 0===this.levelColors[o]&&(this.levelColors[o]=this.getRandomColor()),t.each(n,function(){var n=t(this);if(e.isExcluded(n))return!0;var i=e.getElementData(n);if(i.width>=e.options.valueAnnotationThreshold&&i.height>=e.options.valueAnnotationThreshold){var r=e.getRandomId();if(e.drawElementMask(r,o,i.left-e.elementData.left,i.top-e.elementData.top,i.width,i.height),e.options.showSizing&&(e.drawArrow(r,"width",!0,i.left-e.elementData.left,i.top-e.elementData.top,i.width),e.drawArrow(r,"height",!1,i.left-e.elementData.left,i.top-e.elementData.top,i.height)),e.options.showSpacing){var s=a.getComputedStyle(this,null),l={};for(var h in e.annotationPropertyMapping.spacing)s[e.annotationPropertyMapping.spacing[h]]&&(l[e.annotationPropertyMapping.spacing[h]]=parseInt(s[e.annotationPropertyMapping.spacing[h]],10));l.paddingTop>=e.options.valueAnnotationThreshold&&e.drawArrow(r,"paddingTop",!1,i.left-e.elementData.left,i.top-e.elementData.top,l.paddingTop),l.paddingBottom>=e.options.valueAnnotationThreshold&&e.drawArrow(r,"paddingBottom",!1,i.left-e.elementData.left,i.top-e.elementData.top+(i.height-l.paddingBottom),l.paddingBottom),l.paddingLeft>=e.options.valueAnnotationThreshold&&e.drawArrow(r,"paddingLeft",!0,i.left-e.elementData.left,i.top-e.elementData.top,l.paddingLeft),l.paddingRight>=e.options.valueAnnotationThreshold&&e.drawArrow(r,"paddingRight",!0,i.left-e.elementData.left+(i.width-l.paddingRight),i.top-e.elementData.top,l.paddingRight)}}if(!e.isExcludedChildren(n)){var p=n.children();p.length>0&&e.processElements(p,o+1)}})},getElementData:function(t){var a=t.offset();return{left:Math.floor(a.left),top:Math.floor(a.top),width:Math.floor(t.width()),height:Math.floor(t.height())}}},t.fn.xraye=function(a){return this.each(function(){t.data(this,"plugin_xraye")||t.data(this,"plugin_xraye",new i(this,a))})}}(jQuery,window,document);